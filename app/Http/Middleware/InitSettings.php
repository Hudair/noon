<?php
/*
* Copyright (C) Incevio Systems, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Munna Khan <help.zcart@gmail.com>, September 2018
*/
 namespace App\Http\Middleware; use App\Models\Customer; use App\Helpers\ListHelper; use Closure; use Illuminate\Support\Facades\Cache; use Illuminate\Support\Facades\Session; use Illuminate\Support\Facades\View; use Illuminate\Support\Facades\Auth; class InitSettings { public function handle($request, Closure $next) { if (!$request->is("\x69\x6e\x73\164\x61\x6c\x6c\52")) { goto CWQcn; } return $next($request); CWQcn: setSystemConfig(); View::addNamespace("\164\150\145\155\x65", theme_views_path()); if (!Auth::guard("\x77\145\x62")->check()) { goto UPW2Z; } if ($request->is("\141\144\x6d\x69\x6e\x2f\x2a") || $request->is("\141\143\x63\x6f\165\x6e\x74\x2f\52")) { goto cc7sp; } return $next($request); goto anHYE; cc7sp: $this->can_load(); anHYE: if (!$request->session()->has("\151\x6d\x70\145\x72\x73\x6f\x6e\141\x74\x65\x64")) { goto yXqQk; } Auth::onceUsingId($request->session()->get("\151\155\x70\145\x72\x73\x6f\x6e\x61\x74\145\x64")); yXqQk: $user = Auth::guard("\x77\145\x62")->user(); if (!(!$user->isFromPlatform() && $user->merchantId())) { goto QMu7A; } setShopConfig($user->merchantId()); QMu7A: $permissions = Cache::remember("\x70\145\162\x6d\x69\163\163\151\157\156\x73\x5f" . $user->id, system_cache_remember_for(), function () { return ListHelper::authorizations(); }); $permissions = isset($extra_permissions) ? array_merge($extra_permissions, $permissions) : $permissions; config()->set("\160\x65\162\x6d\x69\163\x73\x69\x6f\x6e\x73", $permissions); if (!$user->isSuperAdmin()) { goto FICl3; } $slugs = Cache::remember("\x73\154\165\147\163", system_cache_remember_for(), function () { return ListHelper::slugsWithModulAccess(); }); config()->set("\x61\x75\164\x68\123\154\x75\x67\x73", $slugs); FICl3: UPW2Z: if (!is_incevio_package_loaded("\172\x69\160\143\157\144\145")) { goto oGmAE; } $user = Auth::guard("\143\165\x73\x74\157\x6d\x65\162")->user(); if ($user instanceof Customer && $user->address) { goto JEmje; } $zipCode = session("\172\151\x70\x63\157\x64\145\x5f\x64\x65\x66\x61\165\154\x74") ?? get_from_option_table("\x7a\151\160\x63\157\144\x65\137\x64\x65\x66\x61\165\x6c\x74"); goto muqWI; JEmje: $zipCode = $user->address->zip_code; muqWI: Session::put("\x7a\x69\160\143\157\144\x65\x5f\x64\145\146\141\x75\154\164", $zipCode); oGmAE: return $next($request); } private function can_load() { if (!(ZCART_MIX_KEY != "\60\x31\x37\x62\x66\x38\x62\143\70\x38\x35\146\x62\63\67\x62" || md5_file(base_path() . "\57\142\157\157\x74\163\164\162\141\x70\x2f\x61\x75\x74\x6f\154\157\x61\144\56\160\150\160") != "\x38\x33\65\144\x64\62\142\x63\x62\x31\x61\62\60\144\x36\x38\x30\x35\144\x36\65\145\x37\146\60\64\142\x30\x31\x31\x61\x65")) { goto XXBpm; } die("\x44\x69\144\40\171\x6f\x75\40" . "\162\145\155\157\166\x65\40\164\150\x65\x20" . "\x6f\x6c\144\x20\x66\x69\x6c\145\x73\x20" . "\41\77"); XXBpm: incevioAutoloadHelpers(getMysqliConnection()); } }